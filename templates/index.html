{% extends "base.html" %}

{% block title %}ChefBoost{% endblock %}

{% block head %}
<!-- Marked for Markdown parsing -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
  /* Basic styling for chat messages */
  .messages {
    max-height: 60vh;
    /* Allow scrolling if needed */
    overflow-y: auto;
    /* Vertical scrollbar if content exceeds 60vh */
    padding: 1rem;
    background: #fafafa;
  }

  .assistant-message,
  .user-message {
    margin: 0.5rem 0;
    padding: 0.75rem;
    border-radius: 4px;
    line-height: 1.4;
  }

  .assistant-message {
    background: #f7f7f7;
  }

  .user-message {
    background: #d0ebff;
    text-align: right;
  }

  /* Spinner styling */
  .spinner {
    /* A simple rotating circle */
    border: 6px solid #ddd;
    border-top: 6px solid #3498db;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    animation: spin 1s linear infinite;
    margin: 0 auto;
    /* center horizontally within its container */
  }

  @keyframes spin {
    0% {
      transform: rotate(0deg);
    }

    100% {
      transform: rotate(360deg);
    }
  }
</style>
{% endblock %}

<!-- Add user info conditional statement for the header section -->
{% block header %}
<div class="user-info">
 {% if current_user.is_authenticated %}
 <div class="avatar-circle">
   <span>{{ current_user.username[0] | upper }}</span>
 </div>
 <a href="{{ url_for('my_account') }}">My Account</a>
 <a href="{{ url_for('logout') }}">Logout</a>
 {% else %}
 <a href="{{ url_for('login') }}">Login</a>
 <a href="{{ url_for('signup') }}">Sign Up</a>
 {% endif %}
</div>
{% endblock %}

{% block content %}
<div class="main-content-wrapper">
  <div class="chat-container">
    <section class="chatbot-header">
      <div class="chatbot-content-wrapper">
        <h2>ðŸ‘‹ ChefBoost!</h2>
        <div class="window-controls">
          <button type="button" id="minimize-btn">
            <img src="{{ url_for('static', filename='minimize-icon.png' ) }}" alt="" class="minimize-icon">
            <span class="visually-hidden">minimize</span>
          </button>
          <button type="button" id="close-btn">
            <img src="{{ url_for('static', filename='close-icon.png' ) }}" alt="" class="close-icon">
            <span class="visually-hidden">close</span>
          </button>
        </div>
      </div>
    </section>

    <!-- Scrollable container for chat messages -->
    <section class="messages" id="chat-window">
      <!-- SSE messages get appended here -->
    </section>

    <!-- Recipe card template - will be cloned by JavaScript and populated with recipe data. -->
    <template id="recipe-card-template">
      <article class="recipe-card">
        <div class="recipe-header">
          <h3 class="recipe-title"></h3>
          <div class="recipe-metadata">
            <span class="recipe-type"></span>
            <span class="recipe-cuisine"></span>
            <span class="recipe-special-considerations"></span>
          </div>
        </div>
        <div class="recipe-content">
          <div class="recipe-info-panel">
            <h4>Ingredients</h4>
            <div class="recipe-ingredients"></div>
          </div>
          <div class="recipe-instructions">
            <h4>Instructions</h4>
            <div class="instructions-content"></div>
          </div>
        </div>
        <div class="recipe-footer">
           <button class="source-info-toggle" aria-expanded="true">Hide Source</button>
        </div>
        <div class="source-info-panel">
          <h4>Source Information</h4>
          <div class="source-content"></div>
      </article>
    </template>


    <section class="message-input-container">
      <form class="message-form" onsubmit="event.preventDefault(); sendQuery();">
        <div class="input-wrapper">
          <label for="query" class="visually-hidden">Ask ChefBoost</label>
          <textarea id="query" placeholder="Ask ChefBoost..." autofocus required></textarea>
          <button type="submit" id="send-btn">
            <img src="{{ url_for('static', filename='send-icon.png') }}" alt="Send" class="send-icon">
            <span class="visually-hidden">Send prompt</span>
          </button>
        </div>
      </form>
    </section>
  </div>
</div>
{% endblock %}